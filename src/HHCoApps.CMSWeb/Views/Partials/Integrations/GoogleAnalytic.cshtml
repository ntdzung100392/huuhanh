@using HHCoApps.CMSWeb.Caching
@using Umbraco.Web.Composing
@{
    var umbracoHelper = Current.Factory.GetInstance<UmbracoHelper>();
    var integration = (Integration)umbracoHelper.ContentQuery.ContentSingleFromCache(CachedContent.IntegrationContent);
    var isEnabled = false;

    if (integration != null)
    {
        isEnabled = integration.GaEnabled && !string.IsNullOrEmpty(integration.GaTrackingId);
    }
}

@if (isEnabled)
{
    var gaUrl = $"https://www.googletagmanager.com/gtag/js?id={integration.GaTrackingId}";
    <script async src="@gaUrl"></script>

    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', '@integration.GaTrackingId');
    </script>
}