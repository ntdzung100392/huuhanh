/*!
 * @preserve
 * jquery.scrolldepth.js | v0.9.1
 * Copyright (c) 2016 Rob Flaherty (@robflaherty), Grigoriy Kogan (@gkogan)
 * Licensed under the MIT and GPL licenses.
 */
!function(factory){"function"==typeof define&&define.amd?define(["jquery"],factory):"object"==typeof module&&module.exports?module.exports=factory(require("jquery")):factory(jQuery)}((function($){"use strict";var defaults={minHeight:0,elements:[],percentage:!0,userTiming:!1,pixelDepth:!0,nonInteraction:!0},$window=$(window),cache=[],scrollEventBound=!1,lastPixelDepth=0,standardEventHandler;$.scrollDepth=function(options){var startTime=+new Date;function sendEvent(action,label,scrollDistance,timing){standardEventHandler&&(standardEventHandler(action,{category:"Scroll Depth",label:label,nonInteraction:options.nonInteraction}),options.pixelDepth&&arguments.length>2&&scrollDistance>lastPixelDepth&&(lastPixelDepth=scrollDistance,standardEventHandler("Pixel Depth",{category:"Scroll Depth",label:rounded(scrollDistance),nonInteraction:options.nonInteraction})),options.userTiming&&arguments.length>3&&standardEventHandler(action,{category:"Scroll Depth",label:label,eventTiming:timing}))}function calculateMarks(docHeight){return{"25%":parseInt(.25*docHeight,10),"50%":parseInt(.5*docHeight,10),"75%":parseInt(.75*docHeight,10),"100%":docHeight-5}}function checkMarks(marks,scrollDistance,timing){$.each(marks,(function(key,val){-1===$.inArray(key,cache)&&scrollDistance>=val&&(sendEvent("Percentage",key,scrollDistance,timing),cache.push(key))}))}function checkElements(elements,scrollDistance,timing){$.each(elements,(function(index,elem){-1===$.inArray(elem,cache)&&$(elem).length&&scrollDistance>=$(elem).offset().top&&(sendEvent("Elements",elem,scrollDistance,timing),cache.push(elem))}))}function rounded(scrollDistance){return(250*Math.floor(scrollDistance/250)).toString()}function init(){bindScrollDepth()}function throttle(func,wait){var context,args,result,timeout=null,previous=0,later=function(){previous=new Date,timeout=null,result=func.apply(context,args)};return function(){var now=new Date;previous||(previous=now);var remaining=wait-(now-previous);return context=this,args=arguments,remaining<=0?(clearTimeout(timeout),timeout=null,previous=now,result=func.apply(context,args)):timeout||(timeout=setTimeout(later,remaining)),result}}function bindScrollDepth(){scrollEventBound=!0,$window.on("scroll.scrollDepth",throttle((function(){var docHeight=$(document).height(),winHeight=window.innerHeight?window.innerHeight:$window.height(),scrollDistance=$window.scrollTop()+winHeight,marks=calculateMarks(docHeight),timing=+new Date-startTime;if(cache.length>=options.elements.length+(options.percentage?4:0))return $window.off("scroll.scrollDepth"),void(scrollEventBound=!1);options.elements&&checkElements(options.elements,scrollDistance,timing),options.percentage&&checkMarks(marks,scrollDistance,timing)}),500))}options=$.extend({},defaults,options),$(document).height()<options.minHeight||(standardEventHandler=function(eventName,data){analytics.track(eventName,data)},$.scrollDepth.reset=function(){cache=[],lastPixelDepth=0,$window.off("scroll.scrollDepth"),bindScrollDepth()},$.scrollDepth.addElements=function(elems){void 0!==elems&&$.isArray(elems)&&($.merge(options.elements,elems),scrollEventBound||bindScrollDepth())},$.scrollDepth.removeElements=function(elems){void 0!==elems&&$.isArray(elems)&&$.each(elems,(function(index,elem){var inElementsArray=$.inArray(elem,options.elements),inCacheArray=$.inArray(elem,cache);-1!=inElementsArray&&options.elements.splice(inElementsArray,1),-1!=inCacheArray&&cache.splice(inCacheArray,1)}))},init())}}));